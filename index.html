<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´¾å°éŠæˆ²åˆè¼¯ (æœ€çµ‚ç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #FFB7B2; /* æŸ”å’Œç²‰ */
            --secondary-color: #B5EAD7; /* è–„è·ç¶  */
            --accent-color: #E2F0CB; /* æ·ºé»ƒç¶  */
            --blue-color: #C7CEEA; /* æ·¡ç´«è— */
            --text-color: #555;
            --bg-color: #FFF9F5;
            --button-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            user-select: none;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 5px solid var(--primary-color);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 { color: #FF9AA2; margin-bottom: 10px; font-size: 1.8rem; }
        h2 { font-size: 1.4rem; margin: 15px 0; color: #666; }
        p { font-size: 1rem; color: #888; margin: 10px 0; }

        .hidden { display: none !important; }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            border: none;
            padding: 12px 20px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 8px 0;
            font-weight: bold;
            box-shadow: var(--button-shadow);
            transition: transform 0.1s;
            width: 100%;
            max-width: 320px;
            display: inline-block;
        }

        button:active { transform: translateY(4px); box-shadow: none; }

        .btn-start { background-color: var(--secondary-color); color: #444; }
        .btn-game-select { background-color: #FFDAC1; color: #555; font-size: 1.3rem; margin: 15px 0; padding: 20px; }
        .btn-action { background-color: var(--blue-color); color: #444; }
        .btn-wrong { background-color: #FFB7B2; }
        .btn-answer { background-color: #ffd166; color: #555; }
        
        .footer-controls {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #eee;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-end { background-color: #eee; color: #888; font-size: 0.9rem; padding: 10px; box-shadow: none; }
        .btn-menu { background-color: #fff; border: 2px solid var(--secondary-color); color: var(--secondary-color); }
        
        /* å›åˆ°é¦–é çš„ç‰¹æ®ŠæŒ‰éˆ• */
        .btn-reset-home {
            background-color: white;
            border: 2px solid #FFB7B2;
            color: #FFB7B2;
            margin-top: 30px;
            font-size: 1rem;
        }

        input[type="number"] {
            font-size: 1.5rem;
            padding: 10px;
            width: 80px;
            text-align: center;
            border: 2px solid var(--secondary-color);
            border-radius: 10px;
            color: var(--text-color);
            margin: 20px 0;
        }

        /* éŠæˆ²é¡¯ç¤ºå€ */
        .big-display {
            font-size: 3rem;
            font-weight: bold;
            color: #FF6F61;
            margin: 20px 0;
            min-height: 70px;
            line-height: 1.2;
        }

        /* ç¨å®¶æš—èªçµæœå½ˆçª—å€ */
        .overlay-result {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* æ³¨éŸ³é¡¯ç¤ºå€ */
        .zhuyin-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .zhuyin-card {
            background: #FFF0F5;
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid #FFB7B2;
            min-width: 80px;
        }

        .zhuyin-label {
            font-size: 0.9rem;
            color: #999;
            margin-bottom: 5px;
            display: block;
        }

        .zhuyin-char {
            font-size: 4rem;
            color: #FF6F61;
            font-weight: 900;
            display: block;
            line-height: 1;
        }

        #timer-display, #g1-timer {
            font-size: 3rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin: 10px 0;
        }

        .timer-warning { color: #FFB7B2 !important; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* ç­”æ¡ˆå€ */
        .answer-box {
            background-color: #FFF9C4;
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 1.3rem;
            color: #555;
            font-weight: bold;
            line-height: 1.6;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .player-btn {
            background-color: var(--accent-color);
            font-size: 1rem;
            padding: 15px;
            border-radius: 15px;
        }

        .badge {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        .score-list { list-style: none; padding: 0; text-align: left; }
        .score-list li {
            background: var(--accent-color);
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            align-items: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- 1. å…¨å±€è¨­å®š -->
        <div id="view-setup">
            <h1>ğŸ® æ´¾å°éŠæˆ²åˆè¼¯</h1>
            <p>è¨­å®šä»Šå¤©éŠç©çš„äººæ•¸</p>
            <div>
                <input type="number" id="player-count" value="4" min="2" max="12">
            </div>
            <button class="btn-start" onclick="initApp()">ç¢ºèªäººæ•¸</button>
        </div>

        <!-- 2. éŠæˆ²é¸å–® -->
        <div id="view-menu" class="hidden">
            <h1>é¸æ“‡éŠæˆ²</h1>
            <p>ç›®å‰ç´¯ç©ç¸½åˆ†å°‡æœƒä¿ç•™</p>
            <button class="btn-game-select" onclick="setupGame1()">ğŸ¤« ç¨å®¶æš—èª<br><span style="font-size:0.8rem">ç´”åè©é¡Œåº« / è¼ªæµåˆ¶</span></button>
            <button class="btn-game-select" onclick="setupGame2()">ğŸ”  æ³¨éŸ³å¤§äº‚é¬¥<br><span style="font-size:0.8rem">é¦–å­—è²æ¯+æ¬¡å­—è²æ¯</span></button>
            
            <!-- æ–°å¢ï¼šé‡è¨­æŒ‰éˆ• -->
            <button class="btn-reset-home" onclick="fullReset()">ğŸ”„ é‡è¨­äººæ•¸ / é‡æ–°é–‹å§‹</button>
        </div>

        <!-- === éŠæˆ² 1ï¼šç¨å®¶æš—èª === -->
        <div id="game1-prep" class="hidden">
            <div class="badge">ç¨å®¶æš—èª</div>
            <h2>ğŸ™ˆ è«‹çŒœé¡Œè€…é–‰çœ¼</h2>
            <div class="badge" style="background:#888" id="g1-guesser-name">ç©å®¶ ?</div>
            <p>å…¶ä»–äººæº–å‚™å¥½å¾Œé»æ“Šçœ‹é¡Œç›®</p>
            <button class="btn-action" onclick="g1ShowKeyword()">çœ‹é¡Œç›®</button>
        </div>

        <div id="game1-keyword" class="hidden">
            <div class="badge">é¡Œç›®</div>
            <div class="big-display" id="g1-keyword-display">...</div>
            <p>æƒ³å¥½æç¤ºå¾Œï¼Œé»æ“Šéš±è—</p>
            <button class="btn-action" onclick="g1HideAndStart()">éš±è—ä¸¦è¨ˆæ™‚</button>
        </div>

        <div id="game1-guessing" class="hidden">
            <div class="badge">çŒœé¡Œä¸­</div>
            <div id="g1-timer">40</div>
            <p>è«‹çœçœ¼çœ‹å¤§å®¶çµ¦çš„æç¤ºï¼</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-action" onclick="g1ShowAnswerOverlay(true)">âœ… ç­”å°</button>
                <button class="btn-wrong" onclick="g1ShowAnswerOverlay(false)">âŒ è·³é</button>
            </div>
            
            <!-- ç­”æ¡ˆé¡¯ç¤ºé®ç½© (é è¨­éš±è—) -->
            <div id="g1-overlay" class="overlay-result hidden">
                <h2 id="g1-result-title">ğŸ‰ ç­”å°äº†ï¼</h2>
                <p>é€™ä¸€é¡Œçš„ç­”æ¡ˆæ˜¯ï¼š</p>
                <div class="big-display" id="g1-result-word">...</div>
                <button class="btn-start" onclick="g1FinalizeTurn()">ä¸‹ä¸€ä½ç©å®¶</button>
            </div>
        </div>

        <!-- === éŠæˆ² 2ï¼šæ³¨éŸ³å¤§äº‚é¬¥ (å®Œç¾ç‰ˆ) === -->
        <div id="game2-main" class="hidden">
            <div class="badge">æ³¨éŸ³å¤§äº‚é¬¥</div>
            <p>è«‹çŒœå‡ºç¬¦åˆé€™å…©å€‹é–‹é ­æ³¨éŸ³çš„<b>é›™å­—åè©</b></p>
            
            <div class="zhuyin-container">
                <div class="zhuyin-card">
                    <span class="zhuyin-label">ç¬¬ä¸€å€‹å­—</span>
                    <span class="zhuyin-char" id="g2-zhuyin1">ã„…</span>
                </div>
                <div class="zhuyin-card">
                    <span class="zhuyin-label">ç¬¬äºŒå€‹å­—</span>
                    <span class="zhuyin-char" id="g2-zhuyin2">ã„‡</span>
                </div>
            </div>

            <!-- ç­”æ¡ˆå€ -->
            <div id="g2-answer-area" class="answer-box hidden">
                <div style="font-size:0.8rem; color:#888;">åƒè€ƒç­”æ¡ˆ (æœ€å¤š3å€‹)ï¼š</div>
                <div id="g2-answer-text"></div>
            </div>

            <div id="g2-timer">40</div>

            <button id="btn-show-ans" class="btn-answer" onclick="g2ShowAnswer()">ğŸ‘€ çœ‹æ­£ç¢ºç­”æ¡ˆ</button>

            <p style="margin-bottom: 5px; margin-top: 15px;">ğŸ‘‡ èª°ç­”å°äº†ï¼Ÿ ğŸ‘‡</p>
            <div id="g2-player-buttons" class="player-grid">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <button class="btn-wrong" style="margin-top:20px; font-size:0.9rem;" onclick="g2NextQuestion()">âŒ æ²’äººç­”å‡ºä¾† / ä¸‹ä¸€é¡Œ</button>
        </div>

        <!-- 3. çµç®—ç•«é¢ -->
        <div id="view-results" class="hidden">
            <h1>ğŸ† ç›®å‰æˆ°ç¸¾</h1>
            <ul id="score-list" class="score-list"></ul>
            <button class="btn-start" onclick="backToMenu()">å›åˆ°éŠæˆ²é¸å–®</button>
        </div>

        <!-- åº•éƒ¨é€šç”¨æ§åˆ¶åˆ— -->
        <div id="footer-controls" class="footer-controls hidden">
            <button class="btn-menu" onclick="backToMenu()">ğŸ  å›é¸å–®</button>
            <button class="btn-end" onclick="showResults()">ğŸ çµæŸéŠæˆ²ä¸¦çµç®—</button>
        </div>
    </div>

    <script>
        // --- 500+ ç¨å®¶æš—èªé¡Œåº« (ç´”åè©/äººç‰©/åœ°é»/ç‰©å“) ---
        const wordString = "çç å¥¶èŒ¶,è‡­è±†è…,å¤¾å¨ƒå¨ƒæ©Ÿ,åƒåœ¾è»Š,å®‰å…¨å¸½,ä¾¿åˆ©å•†åº—,æ‚ éŠå¡,æ‘©æ‰˜è»Š,è—ç™½æ‹–,é›»é‹,é›æ’,é¹¹é…¥é›,æ»·è‚‰é£¯,ç‰›è‚‰éºµ,å°ç± åŒ…,å°åŒ—101,æ·é‹,é«˜éµ,YouBike,å¤–é€å“¡,å£ç½©,è¡›ç”Ÿç´™,çµ±ä¸€ç™¼ç¥¨,å¥ä¿å¡,è£œç¿’ç­,å¤œå¸‚,æ‰‹æ–é£²,å…¨è¯,éº¥ç•¶å‹,æ˜Ÿå·´å…‹,é¢±é¢¨,åœ°éœ‡,æ¢…é›¨å­£,å¯’æµ,å†·æ°£,å‘¨æ°å€«,è”¡ä¾æ—,äº”æœˆå¤©,é„§ç´«æ£‹,ä¼ä½°,è Ÿç­†å°æ–°,å“†å•¦Aå¤¢,çš®å¡ä¸˜,ç‘ªåˆ©æ­,å“¥å‰æ‹‰,èŸ‘è‚,èšŠå­,å°ç£é»‘ç†Š,çŸ³è™,æŸ¯åŸº,æŸ´çŠ¬,è²“å’ª,æ‰‹æ©Ÿ,å……é›»ç·š,è¡Œå‹•é›»æº,è€³æ©Ÿ,çœ¼é¡,é›¨å‚˜,ä¿æº«ç“¶,èƒŒåŒ…,åˆ®åˆ®æ¨‚,ç´…åŒ…,éº»å°‡,æ˜¥è¯,ç²½å­,é¾èˆŸ,æœˆé¤…,æŸšå­,è–èª•æ¨¹,ç…™ç«,è–ªæ°´,å¹´çµ‚çé‡‘,è€é—†,åŒäº‹,å­¸ç”Ÿ,è€å¸«,è€ƒè©¦,ä½œæ¥­,æš‘å‡,å¯’å‡,ç•¢æ¥­è­‰æ›¸,æ“å ´,ç‡Ÿé¤Šåˆé¤,é‰›ç­†ç›’,æ©¡çš®æ“¦,é»‘æ¿,ç²‰ç­†,æƒæŠŠ,æ‹–æŠŠ,åƒåœ¾æ¡¶,å†°ç®±,æ´—è¡£æ©Ÿ,é›»è¦–,é™æ§å™¨,å¹é¢¨æ©Ÿ,ç‰™åˆ·,ç‰™è†,æ¯›å·¾,æ²æµ´ä¹³,æ´—é«®ç²¾,é¦¬æ¡¶,é¡å­,æ•é ­,æ£‰è¢«,åºŠ,æ²™ç™¼,æ¡Œå­,æ¤…å­,é›»é¢¨æ‰‡,é™¤æ¿•æ©Ÿ,è¨ˆç®—æ©Ÿ,å‰ªåˆ€,ç¾å·¥åˆ€,è† å¸¶,åŸå­ç­†,ç­†è¨˜æœ¬,é›»è…¦,éµç›¤,æ»‘é¼ ,è¢å¹•,éº¥å…‹é¢¨,æ”å½±æ©Ÿ,è…³è¸è»Š,å…¬è»Š,è¨ˆç¨‹è»Š,é£›æ©Ÿ,æ©Ÿå ´,è­·ç…§,è¡Œæç®±,é£¯åº—,çƒ¤è‚‰æ¶,å¸³ç¯·,ç¡è¢‹,æ‰‹é›»ç­’,é˜²èšŠæ¶²,å¤ªé™½,æœˆäº®,æ˜Ÿæ˜Ÿ,é›²,å½©è™¹,é–ƒé›»,é›ªäºº,æµ·é‚Š,æ²™ç˜,æ¯”åŸºå°¼,æ³³è¡£,æ³³é¡,æ•‘ç”Ÿåœˆ,éŠæ¨‚åœ’,æ‘©å¤©è¼ª,é›²éœ„é£›è»Š,æ—‹è½‰æœ¨é¦¬,é¬¼å±‹,å‹•ç‰©åœ’,é•·é ¸é¹¿,å¤§è±¡,ç…å­,è€è™,çŒ´å­,ä¼éµ,ç„¡å°¾ç†Š,ç†Šè²“,å…”å­,çƒé¾œ,é‡‘é­š,é¯Šé­š,é¯¨é­š,æµ·è±š,ç« é­š,èƒèŸ¹,è¦å­,è›¤èœŠ,èšµä»”ç…,å¤§è…¸åŒ…å°è…¸,åœ°ç“œçƒ,ç³–è‘«è˜†,è±¬è¡€ç³•,è±†èŠ±,å‰‰å†°,èŠ’æœå†°,é³³æ¢¨é…¥,å¤ªé™½é¤…,ç‰›èˆŒé¤…,éº»ç³¬,é‡‹è¿¦,è“®éœ§,èŠ’æœ,è¥¿ç“œ,é³³æ¢¨,é¦™è•‰,è˜‹æœ,æ©˜å­,è‘¡è„,è‰è“,æ°´èœœæ¡ƒ,ç«é¾æœ,å¥‡ç•°æœ,æª¸æª¬,ç•ªèŒ„,é«˜éº—èœ,ç©ºå¿ƒèœ,èŠ±æ¤°èœ,ç´…è˜¿è””,ç‰ç±³,åœ°ç“œ,é¦¬éˆ´è–¯,æ´‹è”¥,å¤§è’œ,è¾£æ¤’,é†¬æ²¹,é†‹,é¹½å·´,ç³–,èƒ¡æ¤’ç²‰,ç•ªèŒ„é†¬,ç¾ä¹ƒæ»‹,åå¸,ä¸‰æ˜æ²»,æ¼¢å ¡,è–¯æ¢,æŠ«è–©,ç¾©å¤§åˆ©éºµ,å£½å¸,ç”Ÿé­šç‰‡,æ‹‰éºµ,ç«é‹,ç¾Šè‚‰çˆ,è–‘æ¯é´¨,ç‰›æ’,éµæ¿ç‡’,è‡ªåŠ©é¤,ä¾¿ç•¶,æ°´é¤ƒ,é‹è²¼,è”¥æ²¹é¤…,è›‹é¤…,é£¯ç³°,è±†æ¼¿,ç±³æ¼¿,ç‰›å¥¶,å’–å•¡,å¯æ¨‚,æ±½æ°´,æœæ±,å•¤é…’,ç´…é…’,ç™½é…’,é¦™æª³,å¨å£«å¿Œ,é«˜ç²±é…’,æ£’çƒ,ç±ƒçƒ,è¶³çƒ,ç¾½çƒ,æ¡Œçƒ,ç¶²çƒ,é›»å½±é™¢,é†«é™¢,æ•‘è­·è»Š,æ¶ˆé˜²è»Š,è­¦è»Š,éƒµå·®,è­¦å¯Ÿ,æ¶ˆé˜²å“¡,é†«ç”Ÿ,è­·å£«,å»šå¸«,å¸æ©Ÿ,ç©ºå§,æ©Ÿé•·,ç¸½çµ±,å¸‚é•·,é‡Œé•·,è—äºº,ç¶²ç´…,YouTuber,ç›´æ’­ä¸»,IG,Facebook,LINE,YouTube,Google,Wifi,è—èŠ½,é›»æ± ,æ’åº§,é–‹é—œ,é›»ç‡ˆ,è Ÿç‡­,æ‰“ç«æ©Ÿ,ç«æŸ´,ç…™ç°ç¼¸,æˆ’æŒ‡,é …éŠ,è€³ç’°,æ‰‹éŒ¶,æ‰‹ç’°,çš®å¸¶,é ˜å¸¶,è¥ªå­,é‹å­,æ‹–é‹,é´å­,é«˜è·Ÿé‹,è£™å­,è¤²å­,è¡£æœ,å¤–å¥—,æ¯›è¡£,åœå·¾,æ‰‹å¥—,å¸½å­,éŒ¢åŒ…,é‘°åŒ™,èº«åˆ†è­‰,é§•ç…§,ä¿¡ç”¨å¡,ææ¬¾å¡,å­˜æ‘º,å°ç« ,åˆç´„,ç½°å–®,å¸³å–®,é–€ç¥¨,é›»å½±ç¥¨,è»Šç¥¨,æ©Ÿç¥¨,åœ°åœ–,æŒ‡å—é‡,åœ°çƒå„€,æœ›é é¡,é¡¯å¾®é¡,æ”¾å¤§é¡,æº«åº¦è¨ˆ,æ™‚é˜,é¬§é˜,æ—¥æ›†,æœˆæ›†,ç›¸æ¡†,ç›¸ç°¿,ç›¸æ©Ÿ,åº•ç‰‡,è† å·,ç•«å¸ƒ,é¡æ–™,æ°´å½©,è Ÿç­†,å½©è‰²ç­†,æ¯›ç­†,ç¡¯å°,å¢¨æ°´,é‹¼ç´,å°æç´,å‰ä»–,é¼“,ç¬›å­,å–‡å­,éŸ³éŸ¿,èˆå°,ç‡ˆå…‰,å¸ƒå¹•,è§€çœ¾,æ°£çƒ,å½©å¸¶,è›‹ç³•,å¡ç‰‡,ç¦®ç‰©,é®®èŠ±,å·§å…‹åŠ›,é‘½çŸ³,é»ƒé‡‘,ç™½éŠ€,éŠ…æ¿,éˆ”ç¥¨,æ”¯ç¥¨,è‚¡ç¥¨,éŠ€è¡Œ,éƒµå±€,æ³•é™¢,è­¦å¯Ÿå±€,æ¶ˆé˜²å±€,åœ–æ›¸é¤¨,åšç‰©é¤¨,ç¾è¡“é¤¨,é«”è‚²é¤¨,å…¬åœ’,éŠæ¨‚å ´,åœè»Šå ´,åŠ æ²¹ç«™,æ´—è»Šå ´,ä¿®è»Šå» ,ç†é«®å»³,ç¾å®¹é™¢,å¥èº«æˆ¿,KTV,ç¶²å’–,ä¿é½¡çƒé¤¨,æ’çƒé¤¨,æ¸¸æ³³æ± ,æº«æ³‰,æ²™æ¼ ,æ£®æ—,è‰åŸ,é«˜å±±,ç€‘å¸ƒ,æ²³æµ,æ¹–æ³Š,æµ·æ´‹,å³¶å¶¼,ç«å±±,å±±æ´,éš§é“,æ©‹æ¨‘,é¦¬è·¯,ç´…ç¶ ç‡ˆ,æ–‘é¦¬ç·š,å¤©æ©‹,åœ°ä¸‹é“,è·¯ç‡ˆ,è·¯æ¨¹,èŠ±åœƒ,è‰åœ°,æ³¥åœŸ,çŸ³é ­,æ²™å­,ç°å¡µ,ç©ºæ°£,æ°´,ç«,é¢¨,å½±å­,è²éŸ³,å‘³é“,é¡è‰²,å½¢ç‹€,åœ“å½¢,æ–¹å½¢,ä¸‰è§’å½¢,æ„›å¿ƒ,ç¬‘è‡‰,å“­è‡‰,çˆºçˆº,å¥¶å¥¶,å¤–å…¬,å¤–å©†,å”å”,é˜¿å§¨,ä¼¯çˆ¶,ä¼¯æ¯,èˆ…èˆ…,èˆ…åª½,å§‘å§‘,å§‘ä¸ˆ,è¡¨å“¥,è¡¨å¦¹,å ‚å¼Ÿ,å ‚å§,é„°å±…,æœ‹å‹,åŒå­¸,æƒ…ä¾¶,å¤«å¦»,å®¶äºº,å¯µç‰©,ä¸»äºº,å®¢äºº,æ•µäºº,é™Œç”Ÿäºº,å¤–æ˜Ÿäºº,é¬¼,ç¥,å¤©ä½¿,æƒ¡é­”,ç²¾éˆ,å·«å¸«,è¶…èƒ½åŠ›,æ™‚å…‰æ©Ÿ,ä»»æ„é–€,ç«¹èœ»èœ“,æ™‚å…‰åŒ…å·¾,ç¸®å°ç‡ˆ,è¨˜æ†¶åå¸,éš±å½¢æ–—ç¯·,é£›å¤©æƒå¸š,é­”æ–,å¯¶åŠ,ç›¾ç‰Œ,é§ç”²,é ­ç›”,å¼“ç®­,å­å½ˆ,å¤§ç‚®,ç‚¸å½ˆ,åœ°é›·,é£›å½ˆ,ç«ç®­,å¤ªç©ºèˆ¹,è¡›æ˜Ÿ,å¤ªç©ºäºº,å®‡å®™,é»‘æ´,éŠ€æ²³,å¤ªé™½ç³»,åœ°çƒ,ç«æ˜Ÿ,æœˆçƒ,æ°´æ˜Ÿ,é‡‘æ˜Ÿ,æœ¨æ˜Ÿ,åœŸæ˜Ÿ";
        const wordDatabase = wordString.split(',');

        // --- ä¿®æ­£ç‰ˆæ³¨éŸ³é¡Œåº«ï¼šé›™å­—è²æ¯å°æ‡‰ (æ ¼å¼ï¼šè²æ¯1-è²æ¯2 : [è©å½™åˆ—è¡¨]) ---
        const zhuyinPairsRaw = {
            "ã„…-ã„‡": "æ–‘é¦¬,å¹«å¿™,ä¿æ¯,ç™½é¦¬,åŒ—é–€,è¡¨é¢",
            "ã„…-ã„Œ": "æš´åŠ›,ä¾¿åˆ©,èŠ­æ¨‚,ç»ç’ƒ,ä¼´ä¾¶,éœ¸å‡Œ",
            "ã„†-ã„§": "æœ‹å‹,ä¾¿å®œ,çš®è¡£",
            "ã„‡-ã„ˆ": "é­”æ³•,æ¨¡ä»¿,ç±³ç²‰,å¯†å°,æ¯é€¢",
            "ã„ˆ-ã„": "é¢¨æ™¯,é£›æ©Ÿ,æ”¾å‡,å¯Œå®¶,åæ“Š,é™„è¿‘",
            "ã„‰-ã„’": "å¤§è±¡,å°è±¡,å¤§å°,åœ°ä¸‹,ä»£è¬,å¤§é›ª",
            "ã„‰-ã„•": "é›»è¦–,è®€æ›¸,ç™»å±±,å–®èº«,å¤§å”,è¢‹é¼ ",
            "ã„Š-ã„§": "å¤ªé™½,åŒæ„,çµ±ä¸€,é«”è‚²,è¨å­,åŒæ¨£",
            "ã„‹-ã„Œ": "åŠªåŠ›,èƒ½åŠ›,èƒ½é‡,å“ªè£¡,è€åŠ›,å¥´éš¸",
            "ã„Œ-ã„™": "èºçµ²,ç¶ è‰²,åƒåœ¾,è—è‰²,æ‹‰è–©,å¾‹å¸«",
            "ã„-ã„": "æ„Ÿè¦º,ä¹¾æ·¨,å† è»,åœ‹å®¶,æ”»æ“Š,å¤è¹Ÿ,é€›è¡—",
            "ã„-ã„Œ": "å¯æ¨‚,å¿«æ¨‚,æé¾,é¡†ç²’,è€ƒæ…®,è‹¦åŠ›",
            "ã„-ã„•": "è­·å£«,å£äº‹,ä½•æ™‚,å¾Œä¸–,ç«å±±,æ¸¾èº«",
            "ã„-ã„™": "é»‘è‰²,ç´…è‰²,æ´»å¡,å¥½é…¸,é»‘è‰²",
            "ã„-ã„‰": "é›è›‹,ç°¡å–®,è¡—é“,æ±ºå®š,å­£åº¦,æ¿€å‹•,è»éšŠ",
            "ã„-ã„": "æ©Ÿæœƒ,çµå©š,é›†åˆ,ç²¾è¯,è¨ˆç•«,å¥è©±",
            "ã„‘-ã„": "å·§å…‹åŠ›,è«‹å®¢,ç¼ºå£,æ°£å­”,å…¨é–‹,ä¹¾å¤",
            "ã„’-ã„": "è¥¿ç“œ,ç¿’æ…£,æ•ˆæœ,ä¿®æ”¹,æ€§æ„Ÿ,é¸è³¼",
            "ã„“-ã„Š": "æ•é ­,è±¬é ­,åµæ¢,æ•´é«”,æš«åœ,é€™å¤©",
            "ã„”-ã„ˆ": "åƒé£¯,å»šæˆ¿,é‡è¦†,è™•ç½°,å‡ºç™¼,å¹é¢¨,æˆåˆ†",
            "ã„•-ã„": "æ‰‹æ©Ÿ,æ™‚é–“,ä¸–ç•Œ,æš‘å‡,æ°´æ™¶,è¨­è¨ˆ,ç¥ç¶“",
            "ã„–-ã„‘": "æ—¥æœŸ,ç†±æƒ…,äººæ¬Š,äººæ°£,å¦‚ä»Š",
            "ã„—-ã„˜": "æ—©é¤,ç¸½è£,çµ„æˆ,é€ æˆ",
            "ã„˜-ã„‡": "è‰è“,è°æ˜,å´é¢,å‚¬çœ ,åˆºèŸ",
            "ã„™-ã„": "å¸æ©Ÿ,å››å­£,éš¨æ©Ÿ,ç§äº¤,å››è§’",
            "ã„§-ã„•": "æµ´å®¤,é†«ç”Ÿ,æ„æ€,é‘°åŒ™,åŸå§‹,é¡è‰²,å„ªå‹¢",
            "ã„¨-ã„": "çƒé¾œ,ç‹åœ‹,å¤–åœ‹,äº”å®˜,ç„¡è¾œ",
            "ã„…-ã„…": "çˆ¸çˆ¸,å¯¶å¯¶,èƒŒåŒ…,æŠ±æŠ±,ä¿å…¨,å¯¶è²",
            "ã„‡-ã„‡": "åª½åª½,å¦¹å¦¹,å¯†ç¢¼,æ»¿æ»¿,ç¾å¤¢,è²·è³£",
            "ã„‹-ã„‹": "å¥¶å¥¶,ç‰›å¥¶,æ³¥æ¿˜",
            "ã„-ã„”": "è­¦å¯Ÿ,æ©Ÿè»Š,ç¶“å¸¸,å¹¾æˆ,åŸºç¤",
            "ã„Œ-ã„": "å²å®³,éˆé­‚,é›¢å©š,è€è™,è·¯æ»‘,éˆæ´»",
            "ã„-ã„’": "é–‹å¿ƒ,å¯æƒœ,ç§‘å­¸,çœ‹æˆ²,ç©ºè™›,çœ‹é›ª",
            "ã„’-ã„—": "é‹å­,å°å­,ç¾åœ¨,å¯«å­—,æ´—æ¾¡,é¸æ“‡,æ˜Ÿåº§"
        };

        const zhuyinDatabase = Object.keys(zhuyinPairsRaw).map(key => ({
            z1: key.split('-')[0],
            z2: key.split('-')[1],
            ans: zhuyinPairsRaw[key].split(',')
        }));

        // --- å…¨å±€è®Šæ•¸ ---
        let players = [];
        let timerInterval;
        
        // ç¨å®¶æš—èªè®Šæ•¸
        let g1_currentWords = [];
        let g1_playerIndex = 0;
        let g1_currentWord = "";
        let g1_pendingCorrect = false;

        // æ³¨éŸ³å¤§äº‚é¬¥è®Šæ•¸
        let g2_availableQuestions = []; // ç”¨æ–¼å­˜æ”¾é‚„æ²’å‡ºéçš„é¡Œç›®
        let currentZhuyinAnswer = [];

        // --- æ ¸å¿ƒæµç¨‹ ---
        function initApp() {
            const count = parseInt(document.getElementById('player-count').value);
            players = [];
            for(let i=1; i<=count; i++) {
                players.push({ id: i, score: 0 });
            }
            switchView('view-menu');
            document.getElementById('footer-controls').classList.remove('hidden');
        }

        // æ–°å¢ï¼šå®Œæ•´é‡ç½®åŠŸèƒ½
        function fullReset() {
            if(confirm("ç¢ºå®šè¦å›åˆ°åˆå§‹ç•«é¢é‡æ–°è¨­å®šäººæ•¸å—ï¼Ÿ\nâš ï¸ ç›®å‰çš„åˆ†æ•¸å°‡æœƒè¢«æ¸…ç©ºå–”ï¼")) {
                location.reload(); // æœ€ä¹¾æ·¨çš„é‡ç½®æ–¹å¼ï¼Œé‡æ–°æ•´ç†é é¢
            }
        }

        function backToMenu() {
            clearInterval(timerInterval);
            switchView('view-menu');
        }

        function showResults() {
            clearInterval(timerInterval);
            const list = document.getElementById('score-list');
            list.innerHTML = '';
            
            const sorted = [...players].sort((a,b) => b.score - a.score);
            
            sorted.forEach((p, idx) => {
                const li = document.createElement('li');
                let icon = idx === 0 ? 'ğŸ‘‘ ' : '';
                li.innerHTML = `<span>${icon}ç©å®¶ ${p.id}</span> <strong>${p.score} åˆ†</strong>`;
                list.appendChild(li);
            });
            
            switchView('view-results');
            document.getElementById('footer-controls').classList.add('hidden');
        }

        // --- éŠæˆ² 1ï¼šç¨å®¶æš—èª ---
        function setupGame1() {
            g1_currentWords = [...wordDatabase];
            g1_currentWords.sort(() => Math.random() - 0.5);
            g1_playerIndex = 0;
            g1NextTurn();
        }

        function g1NextTurn() {
            document.getElementById('g1-guesser-name').textContent = `è¼ªåˆ° ç©å®¶ ${players[g1_playerIndex].id} çŒœé¡Œ`;
            switchView('game1-prep');
        }

        function g1ShowKeyword() {
            if(g1_currentWords.length === 0) {
                alert("é¡Œç›®å…¨éƒ¨ç”¨å®Œå›‰ï¼å°‡é‡æ–°æ´—ç‰Œã€‚");
                g1_currentWords = [...wordDatabase].sort(() => Math.random() - 0.5);
            }
            g1_currentWord = g1_currentWords.pop();
            document.getElementById('g1-keyword-display').textContent = g1_currentWord;
            switchView('game1-keyword');
        }

        function g1HideAndStart() {
            document.getElementById('g1-overlay').classList.add('hidden');
            switchView('game1-guessing');
            startTimer('g1-timer', 40, () => {});
        }

        function g1ShowAnswerOverlay(isCorrect) {
            clearInterval(timerInterval);
            g1_pendingCorrect = isCorrect;
            
            const overlay = document.getElementById('g1-overlay');
            const title = document.getElementById('g1-result-title');
            const wordDisplay = document.getElementById('g1-result-word');
            
            wordDisplay.textContent = g1_currentWord;
            
            if(isCorrect) {
                title.textContent = "ğŸ‰ ç­”å°äº†ï¼";
                title.style.color = "#FF6F61";
            } else {
                title.textContent = "ğŸ˜… è·³é / ç­”éŒ¯";
                title.style.color = "#888";
            }
            
            overlay.classList.remove('hidden');
        }

        function g1FinalizeTurn() {
            if(g1_pendingCorrect) {
                players[g1_playerIndex].score++;
            }
            g1_playerIndex = (g1_playerIndex + 1) % players.length;
            g1NextTurn();
        }

        // --- éŠæˆ² 2ï¼šæ³¨éŸ³å¤§äº‚é¬¥ (ä¸é‡è¤‡é‚è¼¯) ---
        function setupGame2() {
            // åˆå§‹åŒ–ï¼šè¤‡è£½ä¸€ä»½å®Œæ•´çš„é¡Œåº«åˆ° g2_availableQuestions
            g2_availableQuestions = [...zhuyinDatabase];

            const grid = document.getElementById('g2-player-buttons');
            grid.innerHTML = '';
            players.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.innerHTML = `ç©å®¶ ${p.id}<br>å¾—åˆ†`;
                btn.onclick = (e) => g2PlayerScore(p.id, e.target);
                grid.appendChild(btn);
            });
            
            g2NextQuestion();
        }

        function g2NextQuestion() {
            // éš±è—ç­”æ¡ˆå€
            document.getElementById('g2-answer-area').classList.add('hidden');
            document.getElementById('btn-show-ans').classList.remove('hidden');

            // æª¢æŸ¥é¡Œç›®æ˜¯å¦ç”¨å®Œ
            if (g2_availableQuestions.length === 0) {
                alert("æ‰€æœ‰æ³¨éŸ³é¡Œç›®å·²å‡ºå®Œä¸€è¼ªï¼å°‡é‡æ–°æ´—ç‰Œã€‚");
                g2_availableQuestions = [...zhuyinDatabase];
            }

            // éš¨æ©ŸæŠ½å–ä¸¦ç§»é™¤
            const randomIndex = Math.floor(Math.random() * g2_availableQuestions.length);
            const q = g2_availableQuestions[randomIndex];
            // å¾å¯ç”¨æ¸…å–®ä¸­ç§»é™¤é€™é¡Œï¼Œé¿å…é‡è¤‡
            g2_availableQuestions.splice(randomIndex, 1);
            
            document.getElementById('g2-zhuyin1').textContent = q.z1;
            document.getElementById('g2-zhuyin2').textContent = q.z2;
            currentZhuyinAnswer = q.ans; 

            switchView('game2-main');
            startTimer('g2-timer', 40, () => {
                document.getElementById('g2-timer').textContent = "æ™‚é–“åˆ°";
            });
        }

        function g2ShowAnswer() {
            const ansBox = document.getElementById('g2-answer-text');
            
            // é™åˆ¶æœ€å¤šé¡¯ç¤º 3 å€‹ç­”æ¡ˆ
            const displayAnswers = currentZhuyinAnswer.slice(0, 3);
            ansBox.innerHTML = displayAnswers.join("ã€");
            
            if (currentZhuyinAnswer.length > 3) {
                ansBox.innerHTML += " ...ç­‰";
            }

            document.getElementById('g2-answer-area').classList.remove('hidden');
            document.getElementById('btn-show-ans').classList.add('hidden');
        }

        function g2PlayerScore(playerId, btn) {
            clearInterval(timerInterval);
            const player = players.find(p => p.id === playerId);
            if(player) player.score++;
            
            const originalText = btn.innerHTML;
            btn.innerHTML = "ğŸ‘ +1";
            btn.style.background = "#FFD700";
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = ""; 
                g2NextQuestion();
            }, 500);
        }

        // --- é€šç”¨å·¥å…· ---
        function switchView(viewId) {
            const views = [
                'view-setup', 'view-menu', 'view-results',
                'game1-prep', 'game1-keyword', 'game1-guessing',
                'game2-main'
            ];
            views.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            const footer = document.getElementById('footer-controls');
            if(viewId === 'view-setup' || viewId === 'view-results') {
                footer.classList.add('hidden');
            } else {
                footer.classList.remove('hidden');
            }
        }

        function startTimer(elementId, seconds, onFinish) {
            clearInterval(timerInterval);
            let timeLeft = seconds;
            const display = document.getElementById(elementId);
            display.classList.remove('timer-warning');
            display.textContent = timeLeft;

            timerInterval = setInterval(() => {
                timeLeft--;
                display.textContent = timeLeft;
                if(timeLeft <= 10) display.classList.add('timer-warning');
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if(onFinish) onFinish();
                }
            }, 1000);
        }
    </script>
</body>
</html>